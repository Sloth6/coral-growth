#!/usr/bin/env python3
from __future__ import print_function
import random, os, sys, string, argparse, time
from datetime import datetime
from multiprocessing import Pool
import numpy as np
sys.path.append(os.path.abspath('..'))
from tempfile import TemporaryDirectory
import MultiNEAT as NEAT
from coral_growth.simulate import simulate_network

from coral_growth.coral import Coral
from coral_growth.simulate import simulate_genome
from coral_growth.parameters import Parameters

from coral_growth.evolution import evolve_neat, evolve_novelty

# Run with two morphogens.
params = Parameters()
params.addMorphogen()
params.addMorphogen()
params.light_amount = .2

def generate_id(n):
    options = string.ascii_uppercase + string.digits
    return ''.join(random.choice(options) for _ in range(n))

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("--gens", default=100, help="Generations.", type=int)
    parser.add_argument("--out", default='../output', help="Output dir.")
    parser.add_argument("--cores", default=1, help="Number of cores.", type=int)
    # parser.add_argument("--cores", default=1, help="Number of cores.", type=int)
    args = parser.parse_args()
    print(args)

    rid = generate_id(4)
    print('Run ID: ', rid)

    dir_name = rid+"__{:%B_%d_%Y_%H_%M}".format(datetime.now())
    dir_path = os.path.join(args.out, dir_name)
    os.makedirs(dir_path)

    with open(os.path.join(dir_path, 'params.txt'), 'w+') as out:
        for key, value in vars(params).items():
            out.write(key+'\t'+str(value)+'\n')

    # evolve_neat(args.gens, dir_path, rid, args.cores)
    evolve_novelty(args.gens, dir_path, rid, args.cores)
