#!/usr/bin/env python3
from __future__ import division, print_function
import math, random, os, sys
sys.path.append(os.path.abspath('..'))
from plant_growth import constants, neat_params

from plant_growth.simulate import simulate_genome
import MultiNEAT as NEAT
from tempfile import TemporaryDirectory
from plant_growth.viewer import AnimationViewer

# constants.SIMULATION_STEPS = 10

world_configs = [{
    'light_angle': math.radians(0),
    'verbose': True
}]

if __name__ == '__main__':

    with TemporaryDirectory() as tmp_dir:
        path = sys.argv[1]
        genome = NEAT.Genome(path)

        plant = simulate_genome(genome, world_configs, export_folder=tmp_dir)
        exported = os.path.join(tmp_dir, '0')

        files = [f for f in os.listdir(exported) if '.plant.obj' in f]
        files = sorted(files, key=lambda f: int(f.split('.')[0]))
        files = [os.path.join(exported, f) for f in files]
        view = AnimationViewer(files, (800, 800))
        view.main_loop()


